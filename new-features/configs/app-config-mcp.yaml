app:
  title: Three Horizons | Agentic DevOps Platform
  baseUrl: https://devhub.3horizons.ai

backend:
  baseUrl: https://devhub.3horizons.ai
  listen:
    port: 7007
  csp:
    connect-src: ["'self'", 'http:', 'https:']
  cors:
    origin: https://devhub.3horizons.ai
    credentials: true
  # MCP Actions Backend â€” static token auth for MCP clients
  # Generate token: node -p 'require("crypto").randomBytes(24).toString("base64")'
  auth:
    externalAccess:
      - type: static
        options:
          token: ${MCP_TOKEN}
          subject: mcp-clients
        accessRestrictions:
          - plugin: mcp-actions
          - plugin: catalog
  # Register MCP tool plugins with the Actions Registry
  actions:
    pluginSources:
      - software-catalog-mcp-tool
      - techdocs-mcp-tool

auth:
  providers:
    oidc:
      development:
        metadataUrl: '${OIDC_ISSUER}/.well-known/openid-configuration'
        clientId: '${OIDC_CLIENT_ID}'
        clientSecret: '${OIDC_CLIENT_SECRET}'
        authorizationUrl: '${OIDC_ISSUER}/protocol/openid-connect/auth'
        tokenUrl: '${OIDC_ISSUER}/protocol/openid-connect/token'
        userInfoUrl: '${OIDC_ISSUER}/protocol/openid-connect/userinfo'
        scope: openid profile email
        prompt: login

catalog:
  import:
    esModuleShapePackages:
      - '@backstage/plugin-catalog'

integrations:
  github:
    - host: github.com
      token: '${GITHUB_TOKEN}'

# MCP Plugin Configuration
mcp:
  filesystem:
    enabled: true
    rootPath: /workspace
    allowedPaths:
      - /workspace/**
      - /tmp/**
    readOnly: false

  git:
    enabled: true
    allowedRepositories:
      - 'https://github.com/**'
    timeout: 30000

  kubernetes:
    enabled: true
    kubeConfig: /etc/kubeconfig/config
    allowedNamespaces:
      - '*'
    allowedClusters:
      - '*'

  github:
    enabled: true
    token: '${GITHUB_TOKEN}'
    baseUrl: 'https://api.github.com'
    allowedOrganizations:
      - '*'

# Logger Configuration
logger:
  level: debug
  format: json

# Database Configuration
database:
  client: pg
  connection:
    host: '${DB_HOST}'
    port: 5432
    user: '${DB_USER}'
    password: '${DB_PASSWORD}'
    database: '${DB_NAME}'
    ssl: true

# Storage Configuration
storage:
  type: s3
  s3:
    bucket: rhdh-artifacts
    region: us-east-1
    credentials: aws

# Feature Flags
featureFlags:
  dynamicPluginsEnabled: true
  rbacEnabled: true

# RBAC Configuration
rbac:
  policyFile: /etc/config/permission-policies.csv
  cache:
    enabled: true
    ttlSeconds: 3600

# Metrics Configuration
prometheus:
  enabled: true
  port: 9090
  path: /metrics
